<!doctype html>
<html ng-app="todoApp">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>
    <script type="text/javascript">
      angular.module('todoApp', [])
      .directive('vbox', function() {
        return {
          link: function(scope, element, attrs) {
            attrs.$observe('vbox', function(value) {
              element.attr('viewBox', value);
            })
          }
        };
      })
      .controller('TodoListController', function() {
var encStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";

function vector_fromString( v_str ) {
  v_new = new Array();
  for (k = 0; k < v_str.length; k++) {
    s_chr = v_str[k];
    s_int = encStr.indexOf( s_chr );
    s_bin = s_int.toString(2);
    s_bin = String("000000" + s_bin ).slice(-6);
    for(i = 0; i < 6; i++ ) {
      value = (s_bin[i] == 1) ? 1:0 ;
      v_new.push( value );
    }
  };
  return v_new;
}

function matrix_fromString( m_str ) {
  //busco la cantidad de bloques por linea
  m_blks = encStr.indexOf( m_str[0] );

  M = new Array();

  for( var k = 1; k < m_str.length; k+= m_blks) {
    v_slice = m_str.slice(k, k+m_blks);
    v_bin = vector_fromString( v_slice );
    M.push( vector_fromString( v_slice ) );
  }
  return M;
}



        var todoList = this;

        todoList.txt = "D-Of-eP8SP8eP8YP4PH8GH4ADgAHAAHB-ID5yhhAbxC";
        todoList.txt = "DAEoCIYA3UD_0F_yF-yAMfAP3B_3B_jd7nQthezBNfB";
        todoList.rows = matrix_fromString(todoList.txt);

        var rows = todoList.rows.length;
        var cols = todoList.rows[0].length;

        var dots = [];
        for(y = 0; y < rows; y++) {
            for(x = 0; x < cols; x++) {
                var dot = {x: x, y: y, c: todoList.rows[y][x] };
                dots.push( dot );
            }
        }
        todoList.viewBox = "0 0 " + cols + " " + rows;
        todoList.dots = dots;

      });
    </script>
  </head>
  <body>

    <h2></h2>
    <div ng-controller="TodoListController as todoList">

        <div style="max-width: 240px">
          <svg width="100%"
               height="100%"
               vbox="{{todoList.viewBox}}" >

              <rect ng-repeat="dot in todoList.dots"
                    ng-attr-x="{{ dot.x }}"
                    ng-attr-y="{{ dot.y }}"
                    fill="{{ dot.c && 'white' || 'black' }}"
                    width="1"
                    height="1" />
          </svg>  
        </div>

      <form ng-submit="todoList.addTodo()">
        <input type="text" ng-model="todoList.todoText"  size="30"
               placeholder="add new todo here">
        <input class="btn-primary" type="submit" value="add">
      </form>

    </div>
  </body>
</html>
